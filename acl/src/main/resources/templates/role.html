<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>权限页</title>
</head>
<link href="../static/spop-0.1.3/dist/spop.css" th:href="@{/spop-0.1.3/dist/spop.css}" rel="stylesheet">
<link rel="stylesheet" href="../layui/css/layui.css" th:href="@{/layui/css/layui.css}" media="all">
<body>
<div class="layui-fluid" style="margin-top: 20px;">
    <div class="layui-row">
        <div class="layui-col-md3">
            <div class="layui-card" style="width: 100%;">

                <div class="layui-card-header layui-bg-green" style="height: 50px;line-height: 50px;">
                    <div class="layui-row" style="text-indent: 30px;">
                        <div class="layui-col-md5">
                            <span style="font-size: 20px; font-weight: bold;">角色模块</span>
                        </div>
                        <div class="layui-col-md2 layui-col-md-offset4">
                            <i id="role-add" class="layui-icon" style="opacity:0.6;">&#xe608;</i>
                        </div>
                    </div>
                </div>

                <div class="layui-card-body" id="roleDiv">

                </div>

            </div>
        </div>
        <div class="layui-col-md8 layui-col-md-offset1">
            <div>
                <div class="layui-card" style="width: 100%;">

                    <div class="layui-card-header layui-bg-green" style="height: 50px;line-height: 50px;">
                        <div class="layui-row" style="text-indent: 30px;">
                            <div class="layui-col-md5">
                                <span style="font-size: 20px; font-weight: bold;"></span>
                            </div>
                            <div class="layui-col-md2 layui-col-md-offset4">
                                <i id="acl-add" class="layui-icon" style="opacity:0.6;">&#xe608;</i>
                            </div>
                        </div>
                    </div>

                    <div class="layui-card-body">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="roleFormDiv">
    <form class="layui-form" id="roleForm">
        <div class="layui-form-item">
            <label class="layui-form-label">角色姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="roleName" placeholder="请输入角色姓名" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-inline">
                <textarea name="remark" placeholder="备注" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" id="submitRole" type="button">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
<script src="../static/js/jquery-1.9.1.min.js" th:src="@{/js/jquery-1.9.1.min.js}"></script>
<script src="../layui/layui.all.js" th:src="@{/layui/layui.all.js}"></script>
<script src="../static/spop-0.1.3/dist/spop.js" th:src="@{/spop-0.1.3/dist/spop.js}"></script>
<script>
    ;!function () {
        //无需再执行layui.use()方法加载模块，直接使用即可
        var form = layui.form
            , layer = layui.layer;

        $(function () {
            //  当前弹出层
            var currentOpen = null;
            //  是不是新增
            var isCreate = true;
            //  隐藏表单
            $("#roleFormDiv").hide();
            $("#role-add").hover(function () {
                $(this).css({opacity: "1", transition: "opacity 1s"});
            }, function () {
                $(this).css({opacity: "0.6", transition: "opacity 1s"});
            });
            loadRoleList();

            function loadRoleList() {
                $.ajax({
                    url: '/role/list.json',
                    type: 'GET',
                    success: function (result) {
                        if (result.ret) {
                            var roleList = result.data;
                            if (roleList || roleList.length > 0) {
                                for (var i in roleList) {
                                    let div = $("<div style='background-color: #F0F0F0' class='role-div' data-id='' data-name=''></div>");
                                    div.prop("data-id", roleList[i].id);
                                    div.prop("data-name", roleList[i].roleName);
                                    div.text(roleList[i].roleName);
                                    $("#roleDiv").append(div);
                                }
                            }
                        } else {
                            spop({
                                template: '<h4 class="spop-title">加载角色</h4>' + result.msg,
                                group: 'submit-status',
                                style: 'error',
                            });
                        }
                    }
                });
            }

            $("#role-add").click(function () {
                $("#roleFormDiv").show();
                currentOpen = layer.open({
                    title: '添加角色',
                    type: 1,
                    content: $("#roleForm"),
                    shade: 0,
                    cancel: function(){
                        $("#roleFormDiv").hide();
                    }
                });
                isCreate = true;
            });

            $(document).on('click', '#submitRole', function() {
                console.log($("#roleForm").serializeArray());
                $.ajax({
                    url: isCreate ? '/role/save.json' : '/role/update.json',
                    data: $("#roleForm").serializeArray(),
                    type: 'POST',
                    success: function (result) {
                        if (result.ret) {
                            spop({
                                template: isCreate ? '<h4 class="spop-title">添加角色</h4>角色添加成功' : '<h4 class="spop-title">修改角色</h4>角色修改成功',
                                group: 'submit-status',
                                style: 'success',
                                autoclose: 3000
                            });
                            layer.close(currentOpen);
                        } else {
                            spop({
                                template: isCreate ? '<h4 class="spop-title">添加角色</h4>' + result.msg : '<h4 class="spop-title">修改角色</h4>' + result.msg,
                                group: 'submit-status',
                                style: 'error',
                            });
                        }
                    }
                });
            });
        })
    }();
</script>

<style>
    #role-add:hover {
        cursor: pointer;
    }

    .role-div {
        margin-top: 20px;
        height: 35px;
        line-height: 35px;
        text-indent: 30px;
    }

    .role-div:hover {
        cursor: pointer;
    }
</style>
</body>
</html>